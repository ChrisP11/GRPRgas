{% extends 'base.html' %}

{% load custom_filters %}

{% block title %}Scorecard{% endblock %}

{% block content %}
<div class="container my-4">
    <!-- Dynamic Heading -->
    <h1 id="scorecard-heading"></h1>
    <h3>{% if group_id %} {{ group_id }}am - {% endif %} {{ course_name }} - {{ play_date }}</h3>

    <table class="table table-bordered">
        <thead>
            <tr>
                <td>Hole</td>
                {% for hole in course_holes %}
                <td>
                    {% if group_id %}
                    <a href="{% url 'hole_score_data_view' %}?hole_id={{ hole.id }}&game_id={{ game_id }}&group_id={{ group_id }}" class="text-decoration-none">
                        {{ hole.HoleNumber }}
                    </a>
                    {% else %}
                        {{ hole.HoleNumber }}
                    {% endif %}
                </td>
                {% if hole.HoleNumber == 9 %}
                <td>Out</td>
                {% endif %}
                {% if hole.HoleNumber == 18 %}
                <td>In</td>
                <td>Total</td>
                {% endif %}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <!-- Par Row -->
            <tr>
                <td>Par</td>
                {% for hole in course_holes %}
                <td>{{ hole.Par }}</td>
                {% if hole.HoleNumber == 9 %}
                <td class="gray-column"></td> <!-- Placeholder for "Out" total -->
                {% endif %}
                {% if hole.HoleNumber == 18 %}
                <td class="gray-column"></td> <!-- Placeholder for "In" total -->
                <td class="gray-column"></td> <!-- Placeholder for "Total" -->
                {% endif %}
                {% endfor %}
            </tr>

            <!-- Yardage Row -->
            <tr>
                <td>YDG</td>
                {% for hole in course_holes %}
                <td>{{ hole.Yardage }}</td>
                {% if hole.HoleNumber == 9 %}
                <td class="gray-column"></td> <!-- Placeholder for "Out" total -->
                {% endif %}
                {% if hole.HoleNumber == 18 %}
                <td class="gray-column"></td> <!-- Placeholder for "In" total -->
                <td class="gray-column"></td> <!-- Placeholder for "Total" -->
                {% endif %}
                {% endfor %}
            </tr>

            <!-- Handicap Row -->
            <tr>
                <td>HDCP</td>
                {% for hole in course_holes %}
                <td>{{ hole.Handicap }}</td>
                {% if hole.HoleNumber == 9 %}
                <td class="gray-column"></td> <!-- Placeholder for "Out" total -->
                {% endif %}
                {% if hole.HoleNumber == 18 %}
                <td class="gray-column"></td> <!-- Placeholder for "In" total -->
                <td class="gray-column"></td> <!-- Placeholder for "Total" -->
                {% endif %}
                {% endfor %}
            </tr>

            <!-- Player Scores -->
            {% for player in player_list %}
            <tr>
                <td>{{ player.last_name }} - {{ player.net_hdcp }}</td> 
                <!-- <td><a href="{% url 'scorecard_view' %}?game_id={{ game_id }}">{{ player.last_name }}</a>  - {{ player.net_hdcp }} </td> -->
                {% for hole in course_holes %}
                <!-- Hole Scores -->
                <td class="score-cell" 
                    style="
                        {% with player_strokes|get_item:player.pid|get_item:hole.HoleNumber as strokes %}
                        {% if player_scores|get_item:player.pid|get_item:hole.HoleNumber|get_item:'skin' %}
                            background-color: #FFCCCC; border: 2px solid red;
                        {% elif strokes == 1 %}
                            background-color: #FFF8DC;
                        {% elif strokes == 2 %}
                            background-color: #D0F0C0;
                        {% elif strokes >= 3 %}
                            background-color: #9ACD32;
                        {% endif %}
                        {% endwith %}
                    "
                    data-net="{{ player_scores|get_item:player.pid|get_item:hole.HoleNumber|get_item:'net'|default:'' }}" 
                    data-raw="{{ player_scores|get_item:player.pid|get_item:hole.HoleNumber|get_item:'raw'|default:'' }}">
                    {{ player_scores|get_item:player.pid|get_item:hole.HoleNumber|get_item:'net'|default:'' }}
                </td>
                {% if hole.HoleNumber == 9 %}
                <!-- Out Column -->
                <td class="score-cell" 
                    data-net="{{ player_scores|get_item:player.pid|get_item:'Out'|get_item:'net'|default:'' }}" 
                    data-raw="{{ player_scores|get_item:player.pid|get_item:'Out'|get_item:'raw'|default:'' }}">
                    {{ player_scores|get_item:player.pid|get_item:'Out'|get_item:'net'|default:'' }}
                </td>
                {% endif %}
                {% if hole.HoleNumber == 18 %}
                <!-- In Column -->
                <td class="score-cell" 
                    data-net="{{ player_scores|get_item:player.pid|get_item:'In'|get_item:'net'|default:'' }}" 
                    data-raw="{{ player_scores|get_item:player.pid|get_item:'In'|get_item:'raw'|default:'' }}">
                    {{ player_scores|get_item:player.pid|get_item:'In'|get_item:'net'|default:'' }}
                </td>
                <!-- Total Column -->
                <td class="score-cell" 
                    data-net="{{ player_scores|get_item:player.pid|get_item:'Total'|get_item:'net'|default:'' }}" 
                    data-raw="{{ player_scores|get_item:player.pid|get_item:'Total'|get_item:'raw'|default:'' }}">
                    {{ player_scores|get_item:player.pid|get_item:'Total'|get_item:'net'|default:'' }}
                </td>
                {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Toggle Button -->
    <div class="d-flex justify-content-between mb-3">
        <div class="d-grid gap-2">
            <button id="toggle-scores" class="btn btn-secondary">Gross Scores</button>
        </div>
        <div class="d-grid gap-2">
            <a href="{% url 'skins_leaderboard_view' %}?game_id={{ game_id }}" class="btn btn btn-secondary-custom" role="button">Leaderboard</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleButton = document.getElementById('toggle-scores');
        const scoreCells = document.querySelectorAll('.score-cell');
        const heading = document.getElementById('scorecard-heading');
        let showingNet = false; // Default to raw scores

        // Set initial cell values to raw
        scoreCells.forEach(cell => {
            cell.textContent = cell.getAttribute('data-raw');
        });
        heading.textContent = 'Gross';

        toggleButton.textContent = 'Net Scores';

        toggleButton.addEventListener('click', function () {
            showingNet = !showingNet;

            // Update button text
            toggleButton.textContent = showingNet ? 'Gross Scores' : 'Net Scores';

            // Update score cells
            scoreCells.forEach(cell => {
                cell.textContent = showingNet ? cell.getAttribute('data-net') : cell.getAttribute('data-raw');
            });

            // Update heading
            heading.textContent = showingNet ? 'Net' : 'Gross';
        });
    });
</script>
{% endblock %}